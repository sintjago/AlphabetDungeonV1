<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>English Alphabet Dungeon</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
    }
    #game {
      display: grid;
      grid-template-columns: repeat(10, 40px);
      grid-template-rows: repeat(10, 40px);
      margin: 20px auto;
      border: 2px solid #333;
      width: 400px;
      height: 400px;
    }
    .cell {
      width: 40px;
      height: 40px;
      border: 1px solid #ccc;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.2em;
    }
    .player { background-color: #4CAF50; color: white; }
    .monster { background-color: #f44336; color: white; }
    .treasure { background-color: #ffeb3b; color: #333; }
    .potion { background-color: #2196F3; color: white; }
    .stairs { background-color: #9C27B0; color: white; }
    .wall { background-color: #999; }
    #event-log {
      max-width: 400px;
      margin: 20px auto;
      text-align: left;
      border: 1px solid #ddd;
      padding: 10px;
      height: 100px;
      overflow-y: auto;
      background: #fefefe;
    }
    .log-entry {
      cursor: pointer;
      color: #4CAF50;
      margin: 0;
    }
    .log-entry:hover {
      text-decoration: underline;
    }
    .accordion {
      max-width: 600px;
      margin: 10px auto;
      text-align: left;
      border: 1px solid #ccc;
      background: #f9f9f9;
    }
    .accordion h3 {
      margin: 0;
      padding: 10px;
      background: #eee;
      cursor: pointer;
    }
    .accordion-content {
      display: none;
      padding: 10px;
    }
    .sound-toggle {
      cursor: pointer;
      margin-left: 10px;
    }
    #letters-conquered {
      max-width: 400px;
      margin: 20px auto;
      border: 1px solid #ccc;
      padding: 10px;
      background-color: #fafafa;
    }
    .conquered-letter {
      display: inline-block;
      margin: 4px;
      padding: 6px 10px;
      border: 1px solid #999;
      border-radius: 4px;
      cursor: pointer;
      background-color: #e0ffe0;
    }
    .conquered-letter:hover {
      background-color: #c0ffc0;
    }
  </style>
</head>
<body>
  <h1>Alphabet Dungeon</h1>

  <div class="accordion">
    <h3 onclick="toggleAccordion()">How to Play</h3>
    <div class="accordion-content" id="instructions">
      <ul>
        <li><strong>P</strong> = Player</li>
        <li><strong>T</strong> = Treasure</li>
        <li><strong>H</strong> = Health Potion</li>
        <li><strong>S</strong> = Stairs to next level</li>
        <li><strong>Aâ€“Z</strong> = Monsters. Click them to hear info!</li>
      </ul>
      <p>Use arrow keys to move. Fight monsters with dice rolls. Collect loot, armor, and survive deeper levels!</p>
    </div>
  </div>

  <div id="game"></div>

  <p id="status">Use arrow keys to explore!</p>
  <p>
    Level: <span id="level">A</span> |
    Health: <span id="health">100</span> |
    Armor: <span id="armor">0</span> |
    Coins: <span id="coins">0</span>
    <span class="sound-toggle" onclick="toggleSound()">ðŸ”Š</span>
  </p>

  <div id="dice-game" style="display:none;">
    <p>
      Roll the dice! Click each button to roll.
      <button onclick="autoResolveCombat()">Auto-Resolve</button>
    </p>
    <p>
      Player Health: <span id="player-combat-health">0</span> |
      Monster <span id="monster-type">X</span> Health: <span id="monster-combat-health">0</span>
    </p>
    <button onclick="rollPlayerDice()">Player Dice: <span id="player-dice">0</span></button>
    <button onclick="rollMonsterDice()">Monster Dice: <span id="monster-dice">0</span></button>
    <p id="dice-result"></p>
  </div>

  <div id="event-log">
    <p><strong>Event Log:</strong></p>
    <div id="log-entries"></div>
  </div>

  <div id="letters-conquered">
    <strong>Letters Conquered:</strong>
    <div id="conquered-list"></div>
  </div>
<script>
  const alphabet = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
  const gameSize = 10;
  const gameGrid = document.getElementById("game");

  let player = { x: 0, y: 0, health: 100, armor: 0, coins: 0, baseHealth: 100 };
  let currentLevelIndex = 0;
  let monsters = [], treasures = [], potions = [], walls = [], stairs = {};
  let currentMonster = null;
  let playerRolled = false, monsterRolled = false, autoResolving = false;

  let conqueredLetters = {}; // { A: 2, B: 1, ... }

  let soundOn = true;
  const labels = {
    P: "P for Player",
    T: "T for Treasure",
    S: "S for Stairs",
    H: "H for Health Potion"
  };

  const toggleAccordion = () => {
    const panel = document.getElementById("instructions");
    panel.style.display = panel.style.display === "block" ? "none" : "block";
  };

  const toggleSound = () => {
    soundOn = !soundOn;
    document.querySelector('.sound-toggle').textContent = soundOn ? 'ðŸ”Š' : 'ðŸ”‡';
  };

  const speak = (text) => {
    if (!soundOn) return;
    const utter = new SpeechSynthesisUtterance(text);
    utter.lang = "en-US";
    speechSynthesis.cancel();
    setTimeout(() => speechSynthesis.speak(utter), 100);
  };

  const speakAndWait = (text, callback) => {
    if (!soundOn) return callback();
    const utter = new SpeechSynthesisUtterance(text);
    utter.lang = "en-US";
    utter.onend = callback;
    speechSynthesis.cancel();
    setTimeout(() => speechSynthesis.speak(utter), 100);
  };

  const logEvent = (message) => {
    const entry = document.createElement("p");
    entry.textContent = message;
    entry.className = "log-entry";
    const parts = message.split(" ");
    const letter = parts[parts.length - 1];
    if (letter.length === 1 && alphabet.includes(letter)) {
      entry.onclick = () => speak(letter);
    }
    const logContainer = document.getElementById("log-entries");
    if (logContainer) logContainer.appendChild(entry);
  };

  const updateConqueredLetters = () => {
    const container = document.getElementById("conquered-list");
    container.innerHTML = '';
    Object.entries(conqueredLetters).forEach(([letter, count]) => {
      const box = document.createElement("span");
      box.className = "conquered-letter";
      box.textContent = `${letter} Ã— ${count}`;
      box.onclick = () => speak(letter);
      container.appendChild(box);
    });
  };

  const rollDice = () => Math.floor(Math.random() * 20) + 1;

  const rollPlayerDice = () => {
    if (playerRolled) return;
    const roll = rollDice();
    document.getElementById('player-dice').textContent = roll;
    speak(`Player rolls ${roll}`);
    playerRolled = true;
    evaluateFight();
  };

  const rollMonsterDice = () => {
    if (monsterRolled) return;
    const roll = rollDice();
    document.getElementById('monster-dice').textContent = roll;
    speak(`Monster rolls ${roll}`);
    monsterRolled = true;
    evaluateFight();
  };

  const autoResolveCombat = () => {
    if (!currentMonster) return;
    autoResolving = true;

    const loop = () => {
      if (!currentMonster || !autoResolving) return;
      const pRoll = rollDice();
      const mRoll = rollDice();
      document.getElementById('player-dice').textContent = pRoll;
      document.getElementById('monster-dice').textContent = mRoll;
      playerRolled = monsterRolled = true;

      speakAndWait(`Player rolls ${pRoll}`, () => {
        speakAndWait(`Monster rolls ${mRoll}`, () => {
          evaluateFight();
          if (currentMonster && autoResolving) setTimeout(loop, 600);
        });
      });
    };

    loop();
  };
</script>
<script>
  const evaluateFight = () => {
    if (!playerRolled || !monsterRolled) return;

    const p = parseInt(document.getElementById("player-dice").textContent);
    const m = parseInt(document.getElementById("monster-dice").textContent);

    if (p >= m) {
      currentMonster.health -= 20;
      if (currentMonster.health <= 0) {
        const letter = currentMonster.type;
        conqueredLetters[letter] = (conqueredLetters[letter] || 0) + 1;
        updateConqueredLetters();
        logEvent(`Defeated monster ${letter}`);
        monsters = monsters.filter(mon => mon !== currentMonster);
        player.baseHealth += 10;
        player.health += 10;
        document.getElementById('status').textContent = `You defeated ${letter}!`;
        hideDiceGame();
        autoResolving = false;
      } else {
        logEvent(`Hit monster ${currentMonster.type} (HP: ${currentMonster.health})`);
        document.getElementById('status').textContent = `Hit ${currentMonster.type} (HP: ${currentMonster.health})`;
        resetDiceGame();
      }
    } else {
      if (player.armor > 0) player.armor -= 20;
      else player.health -= 20;
      logEvent(`Monster ${currentMonster.type} hit you! (Your HP: ${player.health})`);
      document.getElementById('status').textContent = `Monster hit you! (HP: ${player.health})`;
      if (player.health <= 0) {
        alert("Game Over!");
        initializeGame();
        return;
      }
      resetDiceGame();
    }

    document.getElementById('health').textContent = player.health;
    document.getElementById('armor').textContent = player.armor;
    document.getElementById('player-combat-health').textContent = player.health;
    document.getElementById('monster-combat-health').textContent = currentMonster?.health || 0;
  };

  const resetDiceGame = () => {
    playerRolled = false;
    monsterRolled = false;
    document.getElementById('player-dice').textContent = "0";
    document.getElementById('monster-dice').textContent = "0";
  };

  const showDiceGame = () => {
    document.getElementById("dice-game").style.display = "block";
    document.getElementById("monster-type").textContent = currentMonster.type;
    document.getElementById("player-combat-health").textContent = player.health;
    document.getElementById("monster-combat-health").textContent = currentMonster.health;
    resetDiceGame();
  };

  const hideDiceGame = () => {
    document.getElementById("dice-game").style.display = "none";
    currentMonster = null;
  };

  const renderGrid = () => {
    gameGrid.innerHTML = '';
    for (let y = 0; y < gameSize; y++) {
      for (let x = 0; x < gameSize; x++) {
        const cell = document.createElement("div");
        cell.className = "cell";

        if (x === player.x && y === player.y) {
          cell.classList.add("player");
          cell.textContent = "P";
          cell.onclick = () => speak(labels["P"]);
        } else if (monsters.some(m => m.x === x && m.y === y)) {
          const m = monsters.find(m => m.x === x && m.y === y);
          cell.classList.add("monster");
          cell.textContent = m.type;
          const hp = m.health;
          const atk = 10 + alphabet.indexOf(m.type);
          cell.onclick = () => speak(`${m.type} for Monster. Health ${hp}. Attack ${atk}.`);
        } else if (treasures.some(t => t.x === x && t.y === y)) {
          cell.classList.add("treasure");
          cell.textContent = "T";
          cell.onclick = () => speak(labels["T"]);
        } else if (potions.some(p => p.x === x && p.y === y)) {
          cell.classList.add("potion");
          cell.textContent = "H";
          cell.onclick = () => speak(labels["H"]);
        } else if (x === stairs.x && y === stairs.y) {
          cell.classList.add("stairs");
          cell.textContent = "S";
          cell.onclick = () => speak(labels["S"]);
        } else if (walls.some(w => w.x === x && w.y === y)) {
          cell.classList.add("wall");
        }

        gameGrid.appendChild(cell);
      }
    }
  };

  const randomPosition = (exclude = []) => {
    let pos;
    do {
      pos = { x: Math.floor(Math.random() * gameSize), y: Math.floor(Math.random() * gameSize) };
    } while (exclude.some(e => e.x === pos.x && e.y === pos.y));
    return pos;
  };

  const isReachable = (start, targets, walls) => {
    const queue = [start];
    const visited = new Set();
    const key = (p) => `${p.x},${p.y}`;
    visited.add(key(start));

    while (queue.length > 0) {
      const { x, y } = queue.shift();
      const neighbors = [
        { x: x + 1, y }, { x: x - 1, y },
        { x, y: y + 1 }, { x, y: y - 1 }
      ].filter(p => p.x >= 0 && p.y >= 0 && p.x < gameSize && p.y < gameSize && !walls.some(w => w.x === p.x && w.y === p.y));

      for (const n of neighbors) {
        const k = key(n);
        if (visited.has(k)) continue;
        visited.add(k);
        queue.push(n);

        if (targets.some(t => t.x === n.x && t.y === n.y)) return true;
      }
    }

    return false;
  };

  const generateValidLevel = () => {
    while (true) {
      const used = [{ x: 0, y: 0 }];
      let walls = Array.from({ length: 15 }, () => randomPosition(used));
      used.push(...walls);

      let monsters = Array.from({ length: 3 }, () => {
        const pos = randomPosition(used);
        used.push(pos);
        const type = alphabet.charAt(Math.floor(Math.random() * (currentLevelIndex + 1)));
        return { ...pos, health: 30 + 10 * alphabet.indexOf(type), type };
      });

      let treasures = Array.from({ length: 3 }, () => {
        const pos = randomPosition(used);
        used.push(pos);
        return pos;
      });

      let potions = Array.from({ length: 2 }, () => {
        const pos = randomPosition(used);
        used.push(pos);
        return pos;
      });

      let stairs = randomPosition(used);
      used.push(stairs);

      const reachable = isReachable(
        { x: 0, y: 0 },
        [...monsters, ...treasures, ...potions, stairs],
        walls
      );

      if (reachable) {
        return { walls, monsters, treasures, potions, stairs };
      }
    }
  };

  const triggerTreasure = () => {
    const outcome = Math.floor(Math.random() * 4);
    switch (outcome) {
      case 0: player.coins += 10; logEvent("Found 10 coins!"); break;
      case 1: player.armor += 20; logEvent("Found armor!"); break;
      case 2: player.health = Math.min(player.baseHealth, player.health + 20); logEvent("Healed with potion!"); break;
      case 3:
        const type = alphabet.charAt(Math.floor(Math.random() * (currentLevelIndex + 1)));
        currentMonster = { x: player.x, y: player.y, health: 30 + 10 * alphabet.indexOf(type), type };
        monsters.push(currentMonster);
        speak(`${type} for Monster`);
        logEvent(`Treasure turned out to be monster ${type}!`);
        showDiceGame();
        return;
    }
    document.getElementById("coins").textContent = player.coins;
    document.getElementById("armor").textContent = player.armor;
    document.getElementById("health").textContent = player.health;
  };

  const interactWithPosition = (x, y) => {
    if (walls.some(w => w.x === x && w.y === y)) return;

    if (monsters.some(m => m.x === x && m.y === y)) {
      currentMonster = monsters.find(m => m.x === x && m.y === y);
      speak(`${currentMonster.type} for Monster`);
      logEvent(`Engaged monster ${currentMonster.type}`);
      showDiceGame();
    } else if (treasures.some(t => t.x === x && t.y === y)) {
      speak(labels["T"]);
      triggerTreasure();
      treasures = treasures.filter(t => !(t.x === x && t.y === y));
    } else if (potions.some(p => p.x === x && p.y === y)) {
      speak(labels["H"]);
      player.health = Math.min(player.baseHealth, player.health + 20);
      potions = potions.filter(p => !(p.x === x && p.y === y));
      logEvent("Drank potion and healed!");
      document.getElementById("health").textContent = player.health;
    } else if (x === stairs.x && y === stairs.y) {
      speak(labels["S"]);
      currentLevelIndex = Math.min(alphabet.length - 1, currentLevelIndex + 1);
      document.getElementById("level").textContent = alphabet[currentLevelIndex];
      logEvent("Descended stairs to level " + alphabet[currentLevelIndex]);
      initializeLevel();
    }
  };

  const movePlayer = (dx, dy) => {
    if (document.getElementById("dice-game").style.display === "block") return;
    const nx = player.x + dx, ny = player.y + dy;
    if (nx < 0 || ny < 0 || nx >= gameSize || ny >= gameSize) return;
    if (walls.some(w => w.x === nx && w.y === ny)) return;
    player.x = nx;
    player.y = ny;
    interactWithPosition(nx, ny);
    renderGrid();
  };

  const initializeLevel = () => {
    player.x = 0;
    player.y = 0;
    const { walls: w, monsters: m, treasures: t, potions: p, stairs: s } = generateValidLevel();
    walls = w;
    monsters = m;
    treasures = t;
    potions = p;
    stairs = s;
    hideDiceGame();
    renderGrid();
  };

  const initializeGame = () => {
    player = { x: 0, y: 0, health: 100, armor: 0, coins: 0, baseHealth: 100 };
    currentLevelIndex = 0;
    conqueredLetters = {};
    updateConqueredLetters();
    document.getElementById("level").textContent = alphabet[currentLevelIndex];
    document.getElementById("log-entries").innerHTML = '';
    initializeLevel();
  };

  window.addEventListener("keydown", (e) => {
    if (e.key === "ArrowUp") movePlayer(0, -1);
    else if (e.key === "ArrowDown") movePlayer(0, 1);
    else if (e.key === "ArrowLeft") movePlayer(-1, 0);
    else if (e.key === "ArrowRight") movePlayer(1, 0);
  });

  initializeGame();
</script>
</body>
</html>
