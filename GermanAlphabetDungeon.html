<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Alphabet-Dungeon</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
    }
    #game {
      display: grid;
      grid-template-columns: repeat(10, 40px);
      grid-template-rows: repeat(10, 40px);
      margin: 20px auto;
      border: 2px solid #333;
      width: 400px;
      height: 400px;
    }
    .cell {
      width: 40px;
      height: 40px;
      border: 1px solid #ccc;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.2em;
    }
    .player { background-color: #4CAF50; color: white; }
    .monster { background-color: #f44336; color: white; }
    .treasure { background-color: #ffeb3b; color: #333; }
    .potion { background-color: #2196F3; color: white; }
    .stairs { background-color: #9C27B0; color: white; }
    .wall { background-color: #999; }
    #event-log {
      max-width: 400px;
      margin: 20px auto;
      text-align: left;
      border: 1px solid #ddd;
      padding: 10px;
      height: 100px;
      overflow-y: auto;
      background: #fefefe;
    }
    .log-entry {
      cursor: pointer;
      color: #4CAF50;
      margin: 0;
    }
    .log-entry:hover {
      text-decoration: underline;
    }
    .accordion {
      max-width: 600px;
      margin: 10px auto;
      text-align: left;
      border: 1px solid #ccc;
      background: #f9f9f9;
    }
    .accordion h3 {
      margin: 0;
      padding: 10px;
      background: #eee;
      cursor: pointer;
    }
    .accordion-content {
      display: none;
      padding: 10px;
    }
    .sound-toggle {
      cursor: pointer;
      margin-left: 10px;
    }
    #letters-conquered {
      max-width: 400px;
      margin: 20px auto;
      border: 1px solid #ccc;
      padding: 10px;
      background-color: #fafafa;
    }
    .conquered-letter {
      display: inline-block;
      margin: 4px;
      padding: 6px 10px;
      border: 1px solid #999;
      border-radius: 4px;
      cursor: pointer;
      background-color: #e0ffe0;
    }
    .conquered-letter:hover {
      background-color: #c0ffc0;
    }
  </style>
</head>
<body>
  <h1>Alphabet-Dungeon</h1>

  <div class="accordion">
    <h3 onclick="toggleAccordion()">Spielanleitung</h3>
    <div class="accordion-content" id="instructions">
      <ul>
        <li><strong>J</strong> = Spieler</li>
        <li><strong>T</strong> = Schatz</li>
        <li><strong>P</strong> = Trank</li>
        <li><strong>E</strong> = Treppe zum n√§chsten Level</li>
        <li><strong>A‚ÄìZ</strong> = Monster. Klicken f√ºr Informationen!</li>
      </ul>
      <p>Benutze die Pfeiltasten, um dich zu bewegen. K√§mpfe mit W√ºrfeln gegen Monster. Sammle Beute und √ºberlebe tieferliegende Ebenen!</p>
    </div>
  </div>

  <div id="game"></div>

  <p id="status">Benutze die Pfeiltasten, um zu erkunden!</p>
  <p>
    Ebene: <span id="level">A</span> |
    Gesundheit: <span id="health">100</span> |
    R√ºstung: <span id="armor">0</span> |
    M√ºnzen: <span id="coins">0</span>
    <span class="sound-toggle" onclick="toggleSound()">üîä</span>
  </p>

  <div id="dice-game" style="display:none;">
    <p>
      W√ºrfle! Klicke auf jeden Knopf, um zu w√ºrfeln.
      <button onclick="autoResolveCombat()">Automatisch l√∂sen</button>
    </p>
    <p>
      Gesundheit Spieler: <span id="player-combat-health">0</span> |
      Monster <span id="monster-type">X</span> Gesundheit: <span id="monster-combat-health">0</span>
    </p>
    <button onclick="rollPlayerDice()">Spielerw√ºrfel: <span id="player-dice">0</span></button>
    <button onclick="rollMonsterDice()">Monsterw√ºrfel: <span id="monster-dice">0</span></button>
    <p id="dice-result"></p>
  </div>

  <div id="event-log">
    <p><strong>Ereignisprotokoll:</strong></p>
    <div id="log-entries"></div>
  </div>

  <div id="letters-conquered">
    <strong>Besiegte Buchstaben:</strong>
    <div id="conquered-list"></div>
  </div>
<script>
  const germanAlphabet = [
    "A", "B", "C", "D", "E", "F", "G", "H", "I",
    "J", "K", "L", "M", "N", "O", "P", "Q", "R",
    "S", "T", "U", "V", "W", "X", "Y", "Z"
  ];

  const gameSize = 10;
  const gameGrid = document.getElementById("game");

  let player = { x: 0, y: 0, gesundheit: 100, ruestung: 0, muenzen: 0, basisGesundheit: 100 };
  let aktuellesLevel = 0;
  let monster = [], schaetze = [], traeanke = [], waende = [], treppe = {};
  let aktuellesMonster = null;
  let spielerGewuerfelt = false, monsterGewuerfelt = false, autoLoesen = false;
  let besiegteBuchstaben = {};

  let tonAktiv = true;

  const labels = {
    J: "J wie Spieler",
    T: "T wie Schatz",
    P: "P wie Trank",
    E: "E wie Treppe"
  };

  const buchstabenWoerter = {
    A: "A wie Apfel", B: "B wie Ball", C: "C wie Computer", D: "D wie Delfin",
    E: "E wie Elefant", F: "F wie Fisch", G: "G wie Giraffe", H: "H wie Haus",
    I: "I wie Insel", J: "J wie Spieler", K: "K wie Katze", L: "L wie Lampe",
    M: "M wie Mond", N: "N wie Nase", O: "O wie Orange", P: "P wie Trank",
    Q: "Q wie Qualle", R: "R wie Regen", S: "S wie Sonne", T: "T wie Schatz",
    U: "U wie Uhr", V: "V wie Vogel", W: "W wie Wasser", X: "X wie Xylofon",
    Y: "Y wie Yacht", Z: "Z wie Zebra"
  };

  const toggleAccordion = () => {
    const panel = document.getElementById("instructions");
    panel.style.display = panel.style.display === "block" ? "none" : "block";
  };

  const toggleSound = () => {
    tonAktiv = !tonAktiv;
    document.querySelector('.sound-toggle').textContent = tonAktiv ? 'üîä' : 'üîá';
  };

  const speak = (text) => {
    if (!tonAktiv) return;
    const utter = new SpeechSynthesisUtterance(text);
    utter.lang = "de-DE";
    speechSynthesis.cancel();
    setTimeout(() => speechSynthesis.speak(utter), 100);
  };

  const speakAndWait = (text, callback) => {
    if (!tonAktiv) return callback();
    const utter = new SpeechSynthesisUtterance(text);
    utter.lang = "de-DE";
    utter.onend = callback;
    speechSynthesis.cancel();
    setTimeout(() => speechSynthesis.speak(utter), 100);
  };

  const logEvent = (nachricht) => {
    const eintrag = document.createElement("p");
    eintrag.textContent = nachricht;
    eintrag.className = "log-entry";
    const teile = nachricht.split(" ");
    const buchstabe = teile[teile.length - 1];
    if (buchstabe.length === 1 && germanAlphabet.includes(buchstabe)) {
      eintrag.onclick = () => speak(buchstabenWoerter[buchstabe] || buchstabe);
    }
    const protokoll = document.getElementById("log-entries");
    if (protokoll) protokoll.appendChild(eintrag);
  };

  const updateConqueredLetters = () => {
    const container = document.getElementById("conquered-list");
    container.innerHTML = '';
    Object.entries(besiegteBuchstaben).forEach(([buchstabe, anzahl]) => {
      const box = document.createElement("span");
      box.className = "conquered-letter";
      box.textContent = `${buchstabe} √ó ${anzahl}`;
      box.onclick = () => speak(buchstabenWoerter[buchstabe] || buchstabe);
      container.appendChild(box);
    });
  };

  const wuerfeln = () => Math.floor(Math.random() * 20) + 1;

  const rollPlayerDice = () => {
    if (spielerGewuerfelt) return;
    const wurf = wuerfeln();
    document.getElementById('player-dice').textContent = wurf;
    speak(`Spieler w√ºrfelt ${wurf}`);
    spielerGewuerfelt = true;
    kampfAuswerten();
  };

  const rollMonsterDice = () => {
    if (monsterGewuerfelt) return;
    const wurf = wuerfeln();
    document.getElementById('monster-dice').textContent = wurf;
    speak(`Monster w√ºrfelt ${wurf}`);
    monsterGewuerfelt = true;
    kampfAuswerten();
  };

  const autoResolveCombat = () => {
    if (!aktuellesMonster) return;
    autoLoesen = true;

    const schleife = () => {
      if (!aktuellesMonster || !autoLoesen) return;
      const wurfSpieler = wuerfeln();
      const wurfMonster = wuerfeln();
      document.getElementById('player-dice').textContent = wurfSpieler;
      document.getElementById('monster-dice').textContent = wurfMonster;
      spielerGewuerfelt = monsterGewuerfelt = true;

      speakAndWait(`Spieler w√ºrfelt ${wurfSpieler}`, () => {
        speakAndWait(`Monster w√ºrfelt ${wurfMonster}`, () => {
          kampfAuswerten();
          if (aktuellesMonster && autoLoesen) setTimeout(schleife, 600);
        });
      });
    };

    schleife();
  };
</script>
<script>
  const kampfAuswerten = () => {
    if (!spielerGewuerfelt || !monsterGewuerfelt) return;

    const p = parseInt(document.getElementById("player-dice").textContent);
    const m = parseInt(document.getElementById("monster-dice").textContent);

    if (p >= m) {
      aktuellesMonster.gesundheit -= 20;
      if (aktuellesMonster.gesundheit <= 0) {
        const buchstabe = aktuellesMonster.typ;
        besiegteBuchstaben[buchstabe] = (besiegteBuchstaben[buchstabe] || 0) + 1;
        updateConqueredLetters();
        logEvent(`Du hast das Monster ${buchstabe} besiegt!`);
        monster = monster.filter(mon => mon !== aktuellesMonster);
        player.basisGesundheit += 10;
        player.gesundheit += 10;
        document.getElementById('status').textContent = `Monster ${buchstabe} besiegt!`;
        wuerfelVerstecken();
        autoLoesen = false;
      } else {
        logEvent(`Monster ${aktuellesMonster.typ} getroffen (HP: ${aktuellesMonster.gesundheit})`);
        document.getElementById('status').textContent = `Getroffen: ${aktuellesMonster.typ} (HP: ${aktuellesMonster.gesundheit})`;
        wuerfelZuruecksetzen();
      }
    } else {
      if (player.ruestung > 0) player.ruestung -= 20;
      else player.gesundheit -= 20;
      logEvent(`Monster ${aktuellesMonster.typ} hat dich getroffen! (HP: ${player.gesundheit})`);
      document.getElementById('status').textContent = `Du wurdest getroffen! (HP: ${player.gesundheit})`;
      if (player.gesundheit <= 0) {
        alert("Spiel vorbei!");
        spielStarten();
        return;
      }
      wuerfelZuruecksetzen();
    }

    document.getElementById('health').textContent = player.gesundheit;
    document.getElementById('armor').textContent = player.ruestung;
    document.getElementById('player-combat-health').textContent = player.gesundheit;
    document.getElementById('monster-combat-health').textContent = aktuellesMonster?.gesundheit || 0;
  };

  const wuerfelZuruecksetzen = () => {
    spielerGewuerfelt = false;
    monsterGewuerfelt = false;
    document.getElementById('player-dice').textContent = "0";
    document.getElementById('monster-dice').textContent = "0";
  };

  const wuerfelAnzeigen = () => {
    document.getElementById("dice-game").style.display = "block";
    document.getElementById("monster-type").textContent = aktuellesMonster.typ;
    document.getElementById("player-combat-health").textContent = player.gesundheit;
    document.getElementById("monster-combat-health").textContent = aktuellesMonster.gesundheit;
    wuerfelZuruecksetzen();
  };

  const wuerfelVerstecken = () => {
    document.getElementById("dice-game").style.display = "none";
    aktuellesMonster = null;
  };

  const spielfeldZeichnen = () => {
    gameGrid.innerHTML = '';
    for (let y = 0; y < gameSize; y++) {
      for (let x = 0; x < gameSize; x++) {
        const feld = document.createElement("div");
        feld.className = "cell";

        if (x === player.x && y === player.y) {
          feld.classList.add("player");
          feld.textContent = "J";
          feld.onclick = () => speak(labels["J"]);
        } else if (monster.some(m => m.x === x && m.y === y)) {
          const m = monster.find(m => m.x === x && m.y === y);
          feld.classList.add("monster");
          feld.textContent = m.typ;
          const hp = m.gesundheit;
          const atk = 10 + germanAlphabet.indexOf(m.typ);
          feld.onclick = () => speak(`${buchstabenWoerter[m.typ] || m.typ}. Gesundheit ${hp}. Angriff ${atk}.`);
        } else if (schaetze.some(t => t.x === x && t.y === y)) {
          feld.classList.add("treasure");
          feld.textContent = "T";
          feld.onclick = () => speak(labels["T"]);
        } else if (traeanke.some(p => p.x === x && p.y === y)) {
          feld.classList.add("potion");
          feld.textContent = "P";
          feld.onclick = () => speak(labels["P"]);
        } else if (x === treppe.x && y === treppe.y) {
          feld.classList.add("stairs");
          feld.textContent = "E";
          feld.onclick = () => speak(labels["E"]);
        } else if (waende.some(w => w.x === x && w.y === y)) {
          feld.classList.add("wall");
        }

        gameGrid.appendChild(feld);
      }
    }
  };

  const zufallsPosition = (ausgeschlossen = []) => {
    let pos;
    do {
      pos = { x: Math.floor(Math.random() * gameSize), y: Math.floor(Math.random() * gameSize) };
    } while (ausgeschlossen.some(e => e.x === pos.x && e.y === pos.y));
    return pos;
  };

  const istErreichbar = (start, ziele, waende) => {
    const queue = [start];
    const besucht = new Set();
    const key = (p) => `${p.x},${p.y}`;
    besucht.add(key(start));

    while (queue.length > 0) {
      const { x, y } = queue.shift();
      const nachbarn = [
        { x: x + 1, y }, { x: x - 1, y },
        { x, y: y + 1 }, { x, y: y - 1 }
      ].filter(p => p.x >= 0 && p.y >= 0 && p.x < gameSize && p.y < gameSize && !waende.some(w => w.x === p.x && w.y === p.y));

      for (const n of nachbarn) {
        const k = key(n);
        if (besucht.has(k)) continue;
        besucht.add(k);
        queue.push(n);
        if (ziele.some(t => t.x === n.x && t.y === n.y)) return true;
      }
    }

    return false;
  };

  const levelErzeugen = () => {
    while (true) {
      const benutzt = [{ x: 0, y: 0 }];
      let waende = Array.from({ length: 15 }, () => zufallsPosition(benutzt));
      benutzt.push(...waende);

      let monster = Array.from({ length: 3 }, () => {
        const pos = zufallsPosition(benutzt);
        benutzt.push(pos);
        const typ = germanAlphabet[Math.floor(Math.random() * (aktuellesLevel + 1))];
        return { ...pos, gesundheit: 30 + 10 * germanAlphabet.indexOf(typ), typ };
      });

      let schaetze = Array.from({ length: 3 }, () => {
        const pos = zufallsPosition(benutzt);
        benutzt.push(pos);
        return pos;
      });

      let traeanke = Array.from({ length: 2 }, () => {
        const pos = zufallsPosition(benutzt);
        benutzt.push(pos);
        return pos;
      });

      let treppe = zufallsPosition(benutzt);
      benutzt.push(treppe);

      const erreichbar = istErreichbar(
        { x: 0, y: 0 },
        [...monster, ...schaetze, ...traeanke, treppe],
        waende
      );

      if (erreichbar) {
        return { waende, monster, schaetze, traeanke, treppe };
      }
    }
  };

  const schatzAusloesen = () => {
    const ergebnis = Math.floor(Math.random() * 4);
    switch (ergebnis) {
      case 0: player.muenzen += 10; logEvent("10 M√ºnzen gefunden!"); break;
      case 1: player.ruestung += 20; logEvent("R√ºstung gefunden!"); break;
      case 2: player.gesundheit = Math.min(player.basisGesundheit, player.gesundheit + 20); logEvent("Trank getrunken!"); break;
      case 3:
        const typ = germanAlphabet[Math.floor(Math.random() * (aktuellesLevel + 1))];
        aktuellesMonster = { x: player.x, y: player.y, gesundheit: 30 + 10 * germanAlphabet.indexOf(typ), typ };
        monster.push(aktuellesMonster);
        speak(buchstabenWoerter[typ] || typ);
        logEvent(`Der Schatz war ein Monster: ${typ}`);
        wuerfelAnzeigen();
        return;
    }
    document.getElementById("coins").textContent = player.muenzen;
    document.getElementById("armor").textContent = player.ruestung;
    document.getElementById("health").textContent = player.gesundheit;
  };

  const interagierenMit = (x, y) => {
    if (waende.some(w => w.x === x && w.y === y)) return;

    if (monster.some(m => m.x === x && m.y === y)) {
      aktuellesMonster = monster.find(m => m.x === x && m.y === y);
      speak(buchstabenWoerter[aktuellesMonster.typ] || aktuellesMonster.typ);
      logEvent(`Monster begegnet: ${aktuellesMonster.typ}`);
      wuerfelAnzeigen();
    } else if (schaetze.some(t => t.x === x && t.y === y)) {
      speak(labels["T"]);
      schatzAusloesen();
      schaetze = schaetze.filter(t => !(t.x === x && t.y === y));
    } else if (traeanke.some(p => p.x === x && p.y === y)) {
      speak(labels["P"]);
      player.gesundheit = Math.min(player.basisGesundheit, player.gesundheit + 20);
      traeanke = traeanke.filter(p => !(p.x === x && p.y === y));
      logEvent("Trank getrunken und geheilt!");
      document.getElementById("health").textContent = player.gesundheit;
    } else if (x === treppe.x && y === treppe.y) {
      speak(labels["E"]);
      aktuellesLevel = Math.min(germanAlphabet.length - 1, aktuellesLevel + 1);
      document.getElementById("level").textContent = germanAlphabet[aktuellesLevel];
      logEvent("Zur n√§chsten Ebene abgestiegen: " + germanAlphabet[aktuellesLevel]);
      levelStarten();
    }
  };

  const spielerBewegen = (dx, dy) => {
    if (document.getElementById("dice-game").style.display === "block") return;
    const nx = player.x + dx, ny = player.y + dy;
    if (nx < 0 || ny < 0 || nx >= gameSize || ny >= gameSize) return;
    if (waende.some(w => w.x === nx && w.y === ny)) return;
    player.x = nx;
    player.y = ny;
    interagierenMit(nx, ny);
    spielfeldZeichnen();
  };

  const levelStarten = () => {
    player.x = 0;
    player.y = 0;
    const { waende: w, monster: m, schaetze: t, traeanke: p, treppe: s } = levelErzeugen();
    waende = w;
    monster = m;
    schaetze = t;
    traeanke = p;
    treppe = s;
    wuerfelVerstecken();
    spielfeldZeichnen();
  };

  const spielStarten = () => {
    player = { x: 0, y: 0, gesundheit: 100, ruestung: 0, muenzen: 0, basisGesundheit: 100 };
    aktuellesLevel = 0;
    besiegteBuchstaben = {};
    updateConqueredLetters();
    document.getElementById("level").textContent = germanAlphabet[aktuellesLevel];
    document.getElementById("log-entries").innerHTML = '';
    levelStarten();
  };

  window.addEventListener("keydown", (e) => {
    if (e.key === "ArrowUp") spielerBewegen(0, -1);
    else if (e.key === "ArrowDown") spielerBewegen(0, 1);
    else if (e.key === "ArrowLeft") spielerBewegen(-1, 0);
    else if (e.key === "ArrowRight") spielerBewegen(1, 0);
  });

  spielStarten();
</script>
</body>
</html>
